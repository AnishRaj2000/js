<? if(messages.length > 0) { ?>
	<h1><?=messages[0].subject?></h1>
	<?
	var months		=	[
		'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
	];
	var showdate	=	function(date)
	{
		var now		=	new Date();
		var hours	=	date.getHours();
		var minutes	=	date.getMinutes();
		var pm		=	hours > 12;
		hours		=	hours > 12 ? hours - 12 : hours;
		var ampm	=	pm ? 'pm' : 'am';
		var timestr	=	hours +':'+ minutes +' '+ ampm;
		var full	=	date.getFullYear() + '-' + date.getMonth() + '-' + date.getDate();
		var nowfull	=	now.getFullYear() + '-' + date.getMonth() + '-' + date.getDate();
		str			=	timestr;
		if(full == nowfull) return str;

		str			+=	' &nbsp; ' + months[date.getMonth()] + ' '+ date.getDate();
		if(date.getFullYear() == now.getFullYear()) return str;

		str			+=	', '+ date.getFullYear();
		return str;
	};
	?>
	<ul>
		<? messages.each(function(message) { ?>
			<li class="message <? if(message.unread) { ?>unread<? } ?>">
				<?
				var from = message.persona.name ? message.persona.name : message.persona.screenname;
				?>
				<div class="date"><?=showdate(message.created)?></div>
				<h3 title="From: <?=message.persona.screenname?> | <?=message.persona.email?>">
					<?=from?>
				</h3>
				<div class="body content">
					<?=markdown.toHTML(message.body)?>
				</div>
			</li>
		<? }); ?>
	</ul>
	<form class="standard-form reply">
		<textarea tabindex="1" name="body" placeholder="Reply to this message"></textarea>
		<input tabindex="2" type="submit" value="Reply">
	</form>
<? } else if (num_personas == 0) { ?>
	<div class="content personas">
		<p>
			You have no personas. Before you can send or receive messages, you
			need to set one up.
		</p>
		<div class="persona button add">
			<span>Add a persona</span>
		</div>
	</div>
<? } else { ?>
	<div class="content">
		<p>
			Select a conversation on the left to view it here.
		</p>
	</div>
<? } ?>

